// TODO: change this to a simple grayscale buffer icon file
// XXX: this hacky cursor is used until nogui get reworked again
#include <X11/Xlib.h>

/*$
 Copyright (C) 2013-2023 Azel.

 This file is part of AzPainter.

 AzPainter is free software: you can redistribute it and/or modify
 it under the terms of the GNU General Public License as published by
 the Free Software Foundation, either version 3 of the License, or
 (at your option) any later version.

 AzPainter is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU General Public License for more details.

 You should have received a copy of the GNU General Public License
 along with this program.  If not, see <http://www.gnu.org/licenses/>.
$*/

//描画
const char az_cursor_draw[] = {
9,12, 0,0,
0x01, 0x00, 0x03, 0x00, 0x05, 0x00, 0x09, 0x00, 0x11, 0x00, 0x21, 0x00,
0x41, 0x00, 0x81, 0x00, 0xf9, 0x01, 0x05, 0x00, 0x03, 0x00, 0x01, 0x00,
0x01, 0x00, 0x03, 0x00, 0x07, 0x00, 0x0f, 0x00, 0x1f, 0x00, 0x3f, 0x00,
0x7f, 0x00, 0xff, 0x00, 0xff, 0x01, 0x07, 0x00, 0x03, 0x00, 0x01, 0x00 };

//回転
const char az_cursor_rotate[] = {
21,25,0,0,
0x01,0x00,0x00,0x03,0x00,0x00,0x05,0x00,0x00,0x09,0x00,0x00,0x11,0x00,0x00,0x21,
0x00,0x00,0x41,0x00,0x00,0x81,0x00,0x00,0x01,0x01,0x00,0xf9,0x03,0x00,0x05,0x00,
0x00,0x03,0xf8,0x00,0x01,0xfe,0x03,0x00,0x06,0x07,0x00,0x00,0x06,0x00,0x00,0x0c,
0x00,0x01,0x0c,0x80,0x03,0x0c,0xc0,0x07,0x0c,0xe0,0x0f,0x0c,0x00,0x03,0x06,0x00,
0x07,0x07,0x00,0xfe,0x03,0x00,0xf8,0x00,0x00,0x00,0x00,
0x01,0x00,0x00,0x03,0x00,0x00,0x07,0x00,0x00,0x0f,0x00,0x00,0x1f,0x00,0x00,0x3f,
0x00,0x00,0x7f,0x00,0x00,0xff,0x00,0x00,0xff,0x01,0x00,0xff,0x03,0x00,0x07,0xf8,
0x00,0x03,0xfe,0x03,0x01,0xff,0x07,0x00,0xff,0x0f,0x00,0x06,0x0f,0x00,0x01,0x1e,
0x80,0x03,0x1e,0xc0,0x07,0x1e,0xe0,0x0f,0x1e,0xf0,0x1f,0x1e,0xe0,0x0f,0x0f,0x80,
0xff,0x0f,0x00,0xff,0x07,0x00,0xfe,0x03,0x00,0xf8,0x00 };

Cursor azpainter_x11_cursor(Display* disp, Window xid, char* buf)
{
	int w,h;
	Pixmap img,mask;
	XColor col[2];
	Cursor cur = 0;

	w = buf[0];
	h = buf[1];

	//Pixmap 作成
  Drawable screen = DefaultScreen(disp);

	img = XCreateBitmapFromData(disp, xid,
			(char *)buf + 4, w, h);

	mask = XCreateBitmapFromData(disp, xid,
			(char *)buf + 4 + ((w + 7) >> 3) * h, w, h);

	//カーソル作成

	if(img && mask)
	{
		col[0].pixel = 0;
		col[0].flags = DoRed | DoGreen | DoBlue;
		col[0].red = col[0].green = col[0].blue = 0;

		col[1].pixel = XWhitePixel(disp, screen);
		col[1].flags = DoRed | DoGreen | DoBlue;
		col[1].red = col[1].green = col[1]. blue = 0xffff;

		cur = XCreatePixmapCursor(disp, img, mask, col, col + 1, buf[2], buf[3]);
	}

	//

	if(img) XFreePixmap(disp, img);
	if(mask) XFreePixmap(disp, mask);
	return cur;
}
